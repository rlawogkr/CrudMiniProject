<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Post Detail</title>
</head>
<body>
<h1 th:text="${post.title}">Post Title</h1>
<p th:text="${post.content}">Post Content</p>

<h2>Comments</h2>
<ul>
    <li th:each="comment : ${post.comments}">
        <span th:text="${comment.user.username}"></span>: <span th:text="${comment.content}"></span>
    </li>
</ul>

<form id="commentForm">
    <textarea id="commentContent" name="content" placeholder="Add a comment"></textarea><br>
    <button type="button" onclick="addComment()">Add Comment</button>
</form>
<button th:if="${#authentication.principal.username == post.user.username}" th:onclick="'location.href=\'/posts/' + ${post.id} + '/edit\''">Edit Post</button>
<form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" th:if="${#authentication.principal.username == post.user.username}">
    <button type="submit">Delete Post</button>
</form>

<script>
    async function addComment() {
        const content = document.getElementById('commentContent').value;
        const token = localStorage.getItem('token');
        const postId = document.getElementById('postId').value;

        const response = await fetch('/comments', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({ postId, content })
        });

        if (response.ok) {
            location.reload();
        } else {
            alert('Failed to add comment');
        }
    }
</script>
</body>
</html>
