<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Posts</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // JWT 토큰을 로컬 스토리지에서 가져옴
            const token = localStorage.getItem("jwtToken");

            if (!token) {
                alert("로그인이 필요합니다.");
                window.location.href = "/login";
                return;
            }

            // 게시글 목록을 가져오는 함수
            function fetchPosts() {
                fetch("/api/posts", {
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + token,
                        "Content-Type": "application/json"
                    }
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("인증에 실패했습니다.");
                        }
                        return response.json();
                    })
                    .then(data => {
                        const postsList = document.getElementById("posts-list");
                        postsList.innerHTML = "";
                        data.forEach(post => {
                            const postItem = document.createElement("li");
                            const postLink = document.createElement("a");
                            postLink.href = "/posts/" + post.id;
                            postLink.textContent = post.title;
                            postItem.appendChild(postLink);
                            postsList.appendChild(postItem);
                        });
                    })
                    .catch(error => {
                        console.error("Error fetching posts:", error);
                        alert("게시글을 가져오는데 실패했습니다.");
                    });
            }

            // 게시글 목록을 가져옴
            fetchPosts();
        });
    </script>
</head>
<body>
<h1>Posts</h1>
<ul id="posts-list">
    <!-- JavaScript에서 게시글 목록을 동적으로 추가합니다. -->
</ul>
<a href="/posts/new">Create New Post</a>
</body>
</html>
